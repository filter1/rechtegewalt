function fillText(t){$("#text").html("");var l=t.allLocations;if(l)for(var a=0;a<l.length;a++)$("#text").append("<h2>"+l[a].location+" <small>"+l[a].n+"</small></h2>"),fillIncidents(l[a].incidents);else $("#text").append("<h2>"+t.location+" <small>"+t.n+"</small></h2>"),fillIncidents(t.incidents)}function fillIncidents(t){for(var l=t.length-1;l>=0;l--){var a=new Date(t[l].date);$("#text").append("<p><small>"+a.toLocaleDateString("de-DE")+"</small></p>"),$("#text").append("<p>"+t[l].text+"</p>"),$("#text").append("<p><small>Quelle: "+t[l].source+"</small></p><hr>")}}function sumCities(t){var l,a=0,n=[],o=-1;return $.each(t,function(t,e){if(e.allLocations){n=n.concat(e.allLocations);var i=e.n;i>o&&(o=i,l=e.location),a+=i}else n.push(e),a+=e.n,e.n>o&&(o=e.n,l=e.location)}),{location:l,n:a,allLocations:n}}$(function(){var t=!1;$(window).width()<=992&&(t=!0,$(" #infoText").append("<i>In der mobilen Ansicht wurde die Anzahl der dargestellen Orte reduziert</i>")),$.fn.qtip.defaults.style.classes="qtip-light",$.fn.qtip.defaults.style.def=!1;var l=kartograph.map("#map");l.loadMap("map.svg",function(){l.addLayer("roads",{styles:{stroke:"grey",fill:"white"}}),$.ajax({url:"cities.json",dataType:"json",success:function(a){console.log(kartograph);var n=kartograph.scale.sqrt(a.concat([{n:0}]),"n").range([2,18]);t&&(a=a.filter(function(t){return t.n>11})),l.addSymbols({type:kartograph.LabeledBubble,data:a,location:function(t){return[t.lng,t.lat]},radius:function(t){return n(t.n)},title:function(t){return"Potsdam"==t.location?t.location:"Cottbus"==t.location?t.location:"Frankfurt (Oder)"==t.location?"Frankfurt":null},labelattrs:{"font-size":8,fill:"black"},center:!1,tooltip:function(t){return t.allLocations?"<h3>"+t.location+"<small> +"+(t.allLocations.length-1)+"</small></h3>"+t.n+" Vorfälle":"<h3>"+t.location+"</h3>"+t.n+" Vorfälle"},click:function(t,l,a){if(fillText(t),t.allLocations){t.allLocations[0].location}else{t.location}l.path.attr("fill","black"),$(window).width()<=992&&($("html, body").animate({scrollTop:$("#text").offset().top},2e3),$("#return-to-top").fadeIn(200))},clustering:"noverlap",clusteringOpts:{tolerance:0,maxRatio:1},aggregate:sumCities,sortBy:"radius desc"}),t&&$("[data-hasqtip]").qtip("hide").qtip("disable")}})}),$("#return-to-top").click(function(){$("#return-to-top").fadeOut(200),$("body,html").animate({scrollTop:$("#map").offset().top},500)})});