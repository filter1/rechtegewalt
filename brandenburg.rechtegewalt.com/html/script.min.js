function fillText(t){$("#text").html("");var l=t.allLocations;if(l)for(var n=0;n<l.length;n++)$("#text").append("<h2>"+l[n].location+" <small>"+l[n].n+"</small></h2>"),fillIncidents(l[n].incidents);else $("#text").append("<h2>"+t.location+" <small>"+t.n+"</small></h2>"),fillIncidents(t.incidents)}function fillIncidents(t){for(var l=t.length-1;l>=0;l--){var n=new Date(t[l].date);$("#text").append("<p><small>"+n.toLocaleDateString("de-DE")+"</small></p>"),$("#text").append("<p>"+t[l].text+"</p>"),$("#text").append("<p><small>Quelle: "+t[l].source+"</small></p><hr>")}}function sumCities(t){var l,n=0,a=[],e=-1;return $.each(t,function(t,o){if(o.allLocations){a=a.concat(o.allLocations);var i=o.n;i>e&&(e=i,l=o.location),n+=i}else a.push(o),n+=o.n,o.n>e&&(e=o.n,l=o.location)}),{location:l,n:n,allLocations:a}}$(function(){console.log("test");var t=!1;$(window).width()<=992&&(t=!0,$(" #infoText").append("<i>In der mobilen Ansicht wurde die Anzahl der dargestellen Orte reduziert</i>")),$.fn.qtip.defaults.style.classes="qtip-light",$.fn.qtip.defaults.style.def=!1;var l=kartograph.map("#map");l.loadMap("map.svg",function(){l.addLayer("roads",{styles:{stroke:"grey",fill:"white"}}),$.ajax({url:"cities.json",dataType:"json",success:function(n){var a=kartograph.scale.sqrt(n.concat([{n:0}]),"n").range([2,18]);t&&(n=n.filter(function(t){return t.n>11})),l.addSymbols({type:kartograph.LabeledBubble,data:n,location:function(t){return[t.lng,t.lat]},radius:function(t){return a(t.n)},title:function(t){return"Potsdam"==t.location?t.location:"Cottbus"==t.location?t.location:"Frankfurt (Oder)"==t.location?"Frankfurt":null},labelattrs:{"font-size":6,fill:"black"},center:!1,tooltip:function(t){return t.allLocations?"<h3>"+t.location+"<small> +"+(t.allLocations.length-1)+"</small></h3>"+t.n+" Vorfälle":"<h3>"+t.location+"</h3>"+t.n+" Vorfälle"},click:function(t,l,n){if(fillText(t),t.allLocations){t.allLocations[0].location}else{t.location}l.path.attr("fill","black"),$(window).width()<=992&&($("html, body").animate({scrollTop:$("#text").offset().top},2e3),$("#return-to-top").fadeIn(200))},clustering:"noverlap",clusteringOpts:{tolerance:0,maxRatio:1},aggregate:sumCities,sortBy:"radius desc"}),t&&$("[data-hasqtip]").qtip("hide").qtip("disable")}})}),$("#return-to-top").click(function(){$("#return-to-top").fadeOut(200),$("body,html").animate({scrollTop:$("#map").offset().top},500)})});