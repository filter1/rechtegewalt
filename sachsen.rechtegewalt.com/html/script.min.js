function fillText(t,l){$("#text").html("").scrollTop();var e=t.allLocations;if(e)for(var n=0;n<e.length;n++){if(n){const a=n;var o=$("<h5></h5>");o.html("gehe zu: "+e[a].location+" <small>"+e[a].n+"</small>"),o.css("cursor","pointer"),o.click(function(){var t="#"+escape(e[a].location).replace("%","");l?$("html, body").animate({scrollTop:$(t).offset().top},500):$("#text").scrollTop($("#text").scrollTop()+$(t).position().top)}),o.insertAfter("#text h2:first-child")}$("#text").append("<h2 id="+escape(e[n].location).replace("%","")+">"+e[n].location+" <small>"+e[n].n+"</small></h2>"),fillIncidents(e[n].incidents)}else $("#text").append("<h2>"+t.location+" <small>"+t.n+"</small></h2>"),fillIncidents(t.incidents)}function fillIncidents(t){for(var l=t.length-1;l>=0;l--){var e=new Date(t[l].date);$("#text").append("<p><small>"+e.toLocaleDateString("de-DE")+"</small></p>"),$("#text").append("<p>"+t[l].text+"</p>"),$("#text").append("<p><small>Quelle: "+t[l].source.replace("Quelle: ","")+"</small></p><hr>")}}function sumCities(t){var l,e=0,n=[],a=-1;return $.each(t,function(t,o){if(o.allLocations){n=n.concat(o.allLocations);var i=o.n;i>a&&(a=i,l=o.location),e+=i}else n.push(o),e+=o.n,o.n>a&&(a=o.n,l=o.location)}),{location:l,n:e,allLocations:n}}$(function(){var t=!1;$(window).width()<=992&&(t=!0,$(" #infoText").append("<i>In der mobilen Ansicht wurde die Anzahl der dargestellen Orte reduziert</i>")),$.fn.qtip.defaults.style.classes="qtip-light",$.fn.qtip.defaults.style.def=!1;var l=kartograph.map("#map");l.loadMap("map.svg",function(){l.addLayer("roads",{styles:{stroke:"grey",fill:"white"}}),$.ajax({url:"cities.json",dataType:"json",success:function(e){console.log(kartograph);var n=kartograph.scale.sqrt(e.concat([{n:0}]),"n").range([2,18]);t&&(e=e.filter(function(t){return t.n>11})),l.addSymbols({type:kartograph.LabeledBubble,data:e,location:function(t){return[t.lng,t.lat]},radius:function(t){return n(t.n)},title:function(t){return"Leipzig"==t.location?t.location:"Dresden"==t.location?t.location:"Chemnitz"==t.location?"Chemnitz":null},labelattrs:{"font-size":8,fill:"black"},center:!1,tooltip:function(t){return t.allLocations?"<h3>"+t.location+"<small> +"+(t.allLocations.length-1)+"</small></h3>"+t.n+" Vorfälle":"<h3>"+t.location+"</h3>"+t.n+" Vorfälle"},click:function(l,e,n){if(fillText(l,t),l.allLocations){l.allLocations[0].location}else{l.location}e.path.attr("fill","black"),$(window).width()<=992&&($("html, body").animate({scrollTop:$("#text").offset().top},2e3),$("#return-to-top").fadeIn(200))},clustering:"noverlap",clusteringOpts:{tolerance:0,maxRatio:1},aggregate:sumCities,sortBy:"radius desc"}),t&&$("[data-hasqtip]").qtip("hide").qtip("disable")}})}),$("#return-to-top").click(function(){$("#return-to-top").fadeOut(200),$("body,html").animate({scrollTop:$("#map").offset().top},500)})});