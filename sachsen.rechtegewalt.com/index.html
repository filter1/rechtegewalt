<!DOCTYPE html>
<html lang="de">
    <head>
        <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/qtip2/2.2.1/jquery.qtip.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8">
        <meta name="author" content="Johannes Filter">

        <title>Rechte Gewalt in Sachsen</title>

        <meta name="description" content="Seit 2006 wurden in Sachsen über 1800 Straftaten mit rechtem Hintergrund dokumentiert. Diese Karte gibt einen Überblick.">

        <!-- Twitter Card data -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@fil_ter">
        <meta name="twitter:image" content="http://sachsen.rechtegewalt.com/preview.png">
        <meta name="twitter:url" content="http://sachsen.rechtegewalt.com/">

        <!-- Open Graph data -->
        <meta property="og:title" content="Rechte Gewalt in Sachsen" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://sachsen.rechtegewalt.com/" />
        <meta property="og:image" content="http://sachsen.rechtegewalt.com/preview.png" />
        <meta property="og:description" content="Seit 2006 wurden in Sachsen über 1800 Straftaten mit rechtem Hintergrund dokumentiert. Diese Karte gibt einen Überblick." />

        <style type="text/css">
            html, body, .container-fluid, .row + .row, .col-md-3{
                height: 100%;
            }

            a, a:hover, .btn-link, .btn-link:hover {
                color: #333333;
            }

            @media screen and (min-width: 992px) {

                .outer {
                    position: relative;
                }

                .inner {
                    position: absolute;
                    bottom: 30px;
                    right: 30px;
                    width: 30%;
                }

                .fullHeight {
                    height: 90%;
                    overflow: auto;
                }  
            }

            #infoButton {
                visibility: hidden;
            }
        </style>

        <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script src="https://rawgit.com/DmitryBaranovskiy/raphael/master/raphael-min.js"></script>
        <script src="https://rawgit.com/kartograph/kartograph.js/master/dist/kartograph.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script src="http://cdn.jsdelivr.net/qtip2/2.2.1/jquery.qtip.min.js"></script>

    </head>

    <body>
        <script type="text/javascript">

            function fillText(location, incidents, n) {

                $( "#text" ).html('<h2>' + location + ' <small>' + n +'</small></h2>');
                for (var i = incidents.length - 1; i >= 0; i--) {
                    var mydate = new Date(incidents[i].date);
                    $( "#text" ).append( "<p><small>" + mydate.toLocaleDateString('de-DE') + "</small></p>" );
                    $( "#text" ).append( "<p>" + incidents[i].text + "</p>" );
                    $( "#text" ).append( "<p><small>Quelle: " + incidents[i].source + "</small></p><hr>" );
                }
            };

            $(function() {

                var mobile = false
                if( $(window).width() <= 992 ){
                    mobile = true;

                    $(' #infoText ').append("Weil du mobil unterwegs bist, wurden die Anzahl der Orte reduziert.");
                }

                // initialize tooltips
                $.fn.qtip.defaults.style.classes = 'qtip-light';
                $.fn.qtip.defaults.style.def = false;

                var map = kartograph.map('#map');
                map.loadMap('map.svg', function() {

                    map.addLayer('roads', {
                        styles: {
                            stroke: 'grey',
                            fill: 'white'
                        }
                    });
 
                    $.ajax({
                        url: 'cities.json',
                        dataType: 'json',
                        success: function(cities) {

                            if( mobile ){
                                cities = cities.filter(function (x) {return x.n > 11})
                            }

                            var scale = kartograph.scale.sqrt(cities.concat([{ n: 0 }]), 'n').range([2, 18]);
                            map.addSymbols({
                                type: kartograph.Bubble,
                                data: cities,
                                location: function(city) {
                                    return [city.lng, city.lat];
                                },
                                radius: function(city) {
                                    return scale(city.n);
                                },
                                tooltip: function(city) {
                                    return '<h3>'+city.location+'</h3>'+city.n+' Vorfälle';
                                },
                                click: function(data, path, event) {
                                    fillText(data.location, data.incidents, data.n);

                                    $('#infoText').hide();
                                    $('#infoButton').css("visibility", "visible");


                                    if( mobile ){
                                        $('html, body').animate({
                                            scrollTop: $("#text").offset().top
                                        }, 2000);
                                    }
                                },

                                sortBy: 'radius desc',
                                style: 'fill:#800; stroke: #fff; fill-opacity: 0.5;',
                            });

                            if( mobile ){
                                $('[data-hasqtip]').qtip('hide').qtip('disable');
                            }
                        }
                    });
                });
            });
        </script>
        
        <div class="container-fluid">

             <div class="row">
                 <button id="infoButton" class="pull-right btn btn-default btn-link" type="button">Informationen</button>
             </div>           

            <div class="row clearfix">         
                <div class="col-xs-18 col-md-9 outer">
                    <div class="inner text-center">
                      <h1>Rechte Gewalt<br><small>in Sachsen</small></h1>
                    </div>
                    <div class="fullHeight" id="map"></div>
                </div>


                <script type="text/javascript">
                    $('#infoButton').on('click', function () {
                        $('#infoButton').css("visibility", "hidden");
                        $('#infoText').show();
                        $('#text').html('');
                    });
                </script>

                <div class="col-xs-18 col-md-3 fullHeight">
     
                    <div class="clearfix"></div>

                    <div id="infoText">
                        <p>Seit 2006 wurden in Sachsen über 1800 Straftaten mit rechtem Hintergrund dokumentiert.</p>

                        <p>Klick auf die Kreise, um die Berichte der Vorfälle zu lesen.</p>

                        <br>

                        <p><small>Daten: <a href="https://www.raa-sachsen.de/index.php/chronik.html">RAA Sachsen Opferberatung</a></small></p>

                        <p><small>Idee und Umsetzung: <a href="http://johannesfilter.com">Johannes Filter</a></small></p>

                        <p><small>Framework: <a href="http://kartograph.org">Kartograph.js</a></small></p>

                        <p><small>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</small></p>

                        <p><small><a href="http://johannesfilter.com#impressum">Impressum</a></small></p>
                    </div>

                   <div id="text"></div>

                </div>
            </div>
        </div>
    </body>
</html>